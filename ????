-- UnKnoWn Entity with Crouch Detection and Broken Lights (NO color effect)

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")

local latestRoom = ReplicatedStorage.GameData.LatestRoom.Value
local entityModel = true

-- Không spawn trong Seek, Figure hoặc phòng 50+
if workspace:FindFirstChild("SeekMovingNewClone") or latestRoom == 50 or latestRoom >= 90 then
    entityModel = false
end

if entityModel then
    local Kill = true
    local unknown = game:GetObjects("rbxassetid://10840326834")[1]
    unknown.Name = "UnKnoWn"
    unknown.Parent = workspace

    local part = unknown:FindFirstChildWhichIsA("BasePart") or unknown:FindFirstChildWhichIsA("Part")
    part.CFrame = workspace.CurrentRooms:GetChildren()[#workspace.CurrentRooms:GetChildren() - 1].Parts.Floor.CFrame + Vector3.new(0, 6, 0)

    
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("Model") and obj:FindFirstChild("Light") and obj:FindFirstChild("Break") then
            obj.Break:Destroy()
        end
    end

    wait(3)

    
    task.spawn(function()
        while Kill do
            task.wait(1)

            if humanoid and humanoid.Health > 0 then
                local isCrouching = humanoid.HipHeight <= 0.4

                if not isCrouching then
                    humanoid:TakeDamage(10)
                end

                if humanoid.Health <= 0 then
                    firesignal(ReplicatedStorage.RemotesFolder.DeathHint.OnClientEvent, {
                        "You died to who you call UnKnoWn...",
                        "It punishes those who stand tall.",
                        "Crouch to survive!"
                    }, "Blue")

                    wait(0.01)
                    ReplicatedStorage.GameStats["Player_"..player.Name].Total.DeathCause.Value = "UnKnoWn"
                end
            end
        end
    end)

    
    ReplicatedStorage.GameData.LatestRoom.Changed:Wait()
    Kill = false
    unknown:Destroy()
end

--  Achievement
local achievementGiver = loadstring(game:HttpGet("https://raw.githubusercontent.com/RegularVynixu/Utilities/main/Doors/Custom%20Achievements/Source.lua"))()
achievementGiver({
    Title = "Crouch or Die",
    Desc = "It wants you down low.",
    Reason = "Survived and encountered UnKnoWn.",
    Image = "rbxassetid://71340141113006"
})
